var nodes = [{"id":0,"name":"<| flattenMany |  |>","receivers":[31,28,33,47,60],"emitters":[1]},{"id":1,"name":"<| map(=>) |  |>","receivers":[0],"emitters":[2]},{"id":2,"name":"<| changeToWhen |  |>","receivers":[1],"emitters":[3,4,31,49]},{"id":3,"name":"| constant() |  |>","receivers":[2],"emitters":[]},{"id":4,"name":"<| map(=>) | NotHappend |>","receivers":[2],"emitters":[5,6,10]},{"id":5,"name":"| | key space on up |> | NotHappend |>","receivers":[4],"emitters":[]},{"id":6,"name":"<| integral | [object Object] |>","receivers":[4,28,57,55,60],"emitters":[7]},{"id":7,"name":"<| accumulate(=>) | [object Object] |>","receivers":[6],"emitters":[8]},{"id":8,"name":"<| timeValue | [object Object] |>","receivers":[7],"emitters":[9,10]},{"id":9,"name":"| time(fps: 60) | 1441401077599 |>","receivers":[8],"emitters":[]},{"id":10,"name":"<| changeToWhen | [object Object] |>","receivers":[8,4,27],"emitters":[11,20,22]},{"id":11,"name":"<| integral | [object Object] |>","receivers":[10],"emitters":[12]},{"id":12,"name":"<| accumulate(=>) | [object Object] |>","receivers":[11],"emitters":[13]},{"id":13,"name":"<| timeValue | [object Object] |>","receivers":[12],"emitters":[14,15]},{"id":14,"name":"| time(fps: 60) | 1441401077598 |>","receivers":[13],"emitters":[]},{"id":15,"name":"<| changeToWhen | [object Object] |>","receivers":[13],"emitters":[16,17,18,19,21,23,24,25,26]},{"id":16,"name":"| constant([object Object]) | [object Object] |>","receivers":[15],"emitters":[]},{"id":17,"name":"| | key a on down |> | NotHappend |>","receivers":[15],"emitters":[]},{"id":18,"name":"| | key d on down |> | NotHappend |>","receivers":[15],"emitters":[]},{"id":19,"name":"| | key d on up |> | NotHappend |>","receivers":[15,20],"emitters":[]},{"id":20,"name":"<| transformTime(=>) | NotHappend |>","receivers":[10],"emitters":[19]},{"id":21,"name":"| | key a on up |> | NotHappend |>","receivers":[15,22],"emitters":[]},{"id":22,"name":"<| transformTime(=>) | NotHappend |>","receivers":[10],"emitters":[21]},{"id":23,"name":"| | key s on down |> | NotHappend |>","receivers":[15],"emitters":[]},{"id":24,"name":"| | key w on down |> | NotHappend |>","receivers":[15],"emitters":[]},{"id":25,"name":"| | key w on up |> | NotHappend |>","receivers":[15],"emitters":[]},{"id":26,"name":"| | key s on up |> | NotHappend |>","receivers":[15],"emitters":[]},{"id":27,"name":"<| () |","receivers":[],"emitters":[]},{"id":28,"name":"<| map(=>) | [object Object] |>","receivers":[29],"emitters":[0,6]},{"id":29,"name":"<| whenThen | NotHappend |>","receivers":[30,53],"emitters":[28]},{"id":30,"name":"<| merge | NotHappend |>","receivers":[63,61],"emitters":[31,32,48,54,29,56]},{"id":31,"name":"<| whenThen | NotHappend |>","receivers":[30,2],"emitters":[0]},{"id":32,"name":"<| whenThen | NotHappend |>","receivers":[30,49,36,50],"emitters":[33]},{"id":33,"name":"<| map(=>) | [object Object] |>","receivers":[32],"emitters":[0,34]},{"id":34,"name":"<| flattenMany |  |>","receivers":[57,33,60],"emitters":[35]},{"id":35,"name":"<| map(=>) |  |>","receivers":[34],"emitters":[36]},{"id":36,"name":"<| changeToWhen |  |>","receivers":[35],"emitters":[37,38,32]},{"id":37,"name":"| constant() |  |>","receivers":[36],"emitters":[]},{"id":38,"name":"<| map(=>) | NotHappend |>","receivers":[36],"emitters":[39,40]},{"id":39,"name":"| interval(interval: 2000ms) | NotHappend |>","receivers":[38],"emitters":[]},{"id":40,"name":"<| integral | [object Object] |>","receivers":[38,47,55,60],"emitters":[41]},{"id":41,"name":"<| accumulate(=>) | [object Object] |>","receivers":[40],"emitters":[42]},{"id":42,"name":"<| timeValue | [object Object] |>","receivers":[41],"emitters":[43,44]},{"id":43,"name":"| time(fps: 60) | 1441401077599 |>","receivers":[42],"emitters":[]},{"id":44,"name":"<| changeToWhen | [object Object] |>","receivers":[42],"emitters":[45,46]},{"id":45,"name":"| constant([object Object]) | [object Object] |>","receivers":[44],"emitters":[]},{"id":46,"name":"| interval(interval: 2000ms) | NotHappend |>","receivers":[44],"emitters":[]},{"id":47,"name":"<| map(=>) | [object Object] |>","receivers":[48],"emitters":[0,40]},{"id":48,"name":"<| whenThen | NotHappend |>","receivers":[30,49,50],"emitters":[47]},{"id":49,"name":"<| merge | NotHappend |>","receivers":[2],"emitters":[48,32]},{"id":50,"name":"<| changeToWhen | 0 |>","receivers":[52],"emitters":[51,32,48]},{"id":51,"name":"| constant(0) | 0 |>","receivers":[50],"emitters":[]},{"id":52,"name":"<| changeToWhen | 0 |>","receivers":[68],"emitters":[50,53]},{"id":53,"name":"<| merge | NotHappend |>","receivers":[52,58],"emitters":[54,56,29]},{"id":54,"name":"<| whenThen | NotHappend |>","receivers":[30,53],"emitters":[55]},{"id":55,"name":"<| map(=>) | [object Object] |>","receivers":[54],"emitters":[6,40]},{"id":56,"name":"<| whenThen | NotHappend |>","receivers":[30,53],"emitters":[57]},{"id":57,"name":"<| map(=>) | [object Object] |>","receivers":[56],"emitters":[6,34]},{"id":58,"name":"<| transformTime(=>) | NotHappend |>","receivers":[59,65],"emitters":[53]},{"id":59,"name":"<| changeToWhen | [object Object] |>","receivers":[64],"emitters":[60,58]},{"id":60,"name":"<| map(=>) | [object Object] |>","receivers":[59],"emitters":[6,0,40,34,61]},{"id":61,"name":"<| changeToWhen |  |>","receivers":[60],"emitters":[62,30,63]},{"id":62,"name":"| constant() |  |>","receivers":[61],"emitters":[]},{"id":63,"name":"<| transformTime(=>) | NotHappend |>","receivers":[61],"emitters":[30]},{"id":64,"name":"<| () |","receivers":[],"emitters":[]},{"id":65,"name":"<| changeToWhen | NotHappend |>","receivers":[67],"emitters":[66,58]},{"id":66,"name":"| constant(NotHappend) | NotHappend |>","receivers":[65],"emitters":[]},{"id":67,"name":"<| () |","receivers":[],"emitters":[]},{"id":68,"name":"<| htmlReceiver() |","receivers":[],"emitters":[]}]
var links = [{"source":0,"target":31,"type":"transformator"},{"source":0,"target":28,"type":"transformator"},{"source":0,"target":33,"type":"transformator"},{"source":0,"target":47,"type":"transformator"},{"source":0,"target":60,"type":"transformator"},{"source":1,"target":0,"type":"transformator"},{"source":1,"target":0,"type":"transformator"},{"source":2,"target":1,"type":"transformator"},{"source":2,"target":1,"type":"transformator"},{"source":3,"target":2,"type":"transformator"},{"source":4,"target":2,"type":"transformator"},{"source":31,"target":2,"type":"transformator"},{"source":49,"target":2,"type":"transformator"},{"source":3,"target":2,"type":"emitter"},{"source":4,"target":2,"type":"transformator"},{"source":5,"target":4,"type":"transformator"},{"source":6,"target":4,"type":"transformator"},{"source":10,"target":4,"type":"transformator"},{"source":5,"target":4,"type":"emitter"},{"source":6,"target":4,"type":"transformator"},{"source":6,"target":28,"type":"transformator"},{"source":6,"target":57,"type":"transformator"},{"source":6,"target":55,"type":"transformator"},{"source":6,"target":60,"type":"transformator"},{"source":7,"target":6,"type":"transformator"},{"source":7,"target":6,"type":"transformator"},{"source":8,"target":7,"type":"transformator"},{"source":8,"target":7,"type":"transformator"},{"source":9,"target":8,"type":"transformator"},{"source":10,"target":8,"type":"transformator"},{"source":9,"target":8,"type":"emitter"},{"source":10,"target":8,"type":"transformator"},{"source":10,"target":4,"type":"transformator"},{"source":10,"target":27,"type":"receiver"},{"source":11,"target":10,"type":"transformator"},{"source":20,"target":10,"type":"transformator"},{"source":22,"target":10,"type":"transformator"},{"source":11,"target":10,"type":"transformator"},{"source":12,"target":11,"type":"transformator"},{"source":12,"target":11,"type":"transformator"},{"source":13,"target":12,"type":"transformator"},{"source":13,"target":12,"type":"transformator"},{"source":14,"target":13,"type":"transformator"},{"source":15,"target":13,"type":"transformator"},{"source":14,"target":13,"type":"emitter"},{"source":15,"target":13,"type":"transformator"},{"source":16,"target":15,"type":"transformator"},{"source":17,"target":15,"type":"transformator"},{"source":18,"target":15,"type":"transformator"},{"source":19,"target":15,"type":"transformator"},{"source":21,"target":15,"type":"transformator"},{"source":23,"target":15,"type":"transformator"},{"source":24,"target":15,"type":"transformator"},{"source":25,"target":15,"type":"transformator"},{"source":26,"target":15,"type":"transformator"},{"source":16,"target":15,"type":"emitter"},{"source":17,"target":15,"type":"emitter"},{"source":18,"target":15,"type":"emitter"},{"source":19,"target":15,"type":"emitter"},{"source":19,"target":20,"type":"emitter"},{"source":20,"target":10,"type":"transformator"},{"source":19,"target":20,"type":"transformator"},{"source":21,"target":15,"type":"emitter"},{"source":21,"target":22,"type":"emitter"},{"source":22,"target":10,"type":"transformator"},{"source":21,"target":22,"type":"transformator"},{"source":23,"target":15,"type":"emitter"},{"source":24,"target":15,"type":"emitter"},{"source":25,"target":15,"type":"emitter"},{"source":26,"target":15,"type":"emitter"},{"source":28,"target":29,"type":"transformator"},{"source":0,"target":28,"type":"transformator"},{"source":6,"target":28,"type":"transformator"},{"source":29,"target":30,"type":"transformator"},{"source":29,"target":53,"type":"transformator"},{"source":28,"target":29,"type":"transformator"},{"source":30,"target":63,"type":"transformator"},{"source":30,"target":61,"type":"transformator"},{"source":31,"target":30,"type":"transformator"},{"source":32,"target":30,"type":"transformator"},{"source":48,"target":30,"type":"transformator"},{"source":54,"target":30,"type":"transformator"},{"source":29,"target":30,"type":"transformator"},{"source":56,"target":30,"type":"transformator"},{"source":31,"target":30,"type":"transformator"},{"source":31,"target":2,"type":"transformator"},{"source":0,"target":31,"type":"transformator"},{"source":32,"target":30,"type":"transformator"},{"source":32,"target":49,"type":"transformator"},{"source":32,"target":36,"type":"transformator"},{"source":32,"target":50,"type":"transformator"},{"source":33,"target":32,"type":"transformator"},{"source":33,"target":32,"type":"transformator"},{"source":0,"target":33,"type":"transformator"},{"source":34,"target":33,"type":"transformator"},{"source":34,"target":57,"type":"transformator"},{"source":34,"target":33,"type":"transformator"},{"source":34,"target":60,"type":"transformator"},{"source":35,"target":34,"type":"transformator"},{"source":35,"target":34,"type":"transformator"},{"source":36,"target":35,"type":"transformator"},{"source":36,"target":35,"type":"transformator"},{"source":37,"target":36,"type":"transformator"},{"source":38,"target":36,"type":"transformator"},{"source":32,"target":36,"type":"transformator"},{"source":37,"target":36,"type":"emitter"},{"source":38,"target":36,"type":"transformator"},{"source":39,"target":38,"type":"transformator"},{"source":40,"target":38,"type":"transformator"},{"source":39,"target":38,"type":"emitter"},{"source":40,"target":38,"type":"transformator"},{"source":40,"target":47,"type":"transformator"},{"source":40,"target":55,"type":"transformator"},{"source":40,"target":60,"type":"transformator"},{"source":41,"target":40,"type":"transformator"},{"source":41,"target":40,"type":"transformator"},{"source":42,"target":41,"type":"transformator"},{"source":42,"target":41,"type":"transformator"},{"source":43,"target":42,"type":"transformator"},{"source":44,"target":42,"type":"transformator"},{"source":43,"target":42,"type":"emitter"},{"source":44,"target":42,"type":"transformator"},{"source":45,"target":44,"type":"transformator"},{"source":46,"target":44,"type":"transformator"},{"source":45,"target":44,"type":"emitter"},{"source":46,"target":44,"type":"emitter"},{"source":47,"target":48,"type":"transformator"},{"source":0,"target":47,"type":"transformator"},{"source":40,"target":47,"type":"transformator"},{"source":48,"target":30,"type":"transformator"},{"source":48,"target":49,"type":"transformator"},{"source":48,"target":50,"type":"transformator"},{"source":47,"target":48,"type":"transformator"},{"source":49,"target":2,"type":"transformator"},{"source":48,"target":49,"type":"transformator"},{"source":32,"target":49,"type":"transformator"},{"source":50,"target":52,"type":"transformator"},{"source":51,"target":50,"type":"transformator"},{"source":32,"target":50,"type":"transformator"},{"source":48,"target":50,"type":"transformator"},{"source":51,"target":50,"type":"emitter"},{"source":52,"target":68,"type":"receiver"},{"source":50,"target":52,"type":"transformator"},{"source":53,"target":52,"type":"transformator"},{"source":53,"target":52,"type":"transformator"},{"source":53,"target":58,"type":"transformator"},{"source":54,"target":53,"type":"transformator"},{"source":56,"target":53,"type":"transformator"},{"source":29,"target":53,"type":"transformator"},{"source":54,"target":30,"type":"transformator"},{"source":54,"target":53,"type":"transformator"},{"source":55,"target":54,"type":"transformator"},{"source":55,"target":54,"type":"transformator"},{"source":6,"target":55,"type":"transformator"},{"source":40,"target":55,"type":"transformator"},{"source":56,"target":30,"type":"transformator"},{"source":56,"target":53,"type":"transformator"},{"source":57,"target":56,"type":"transformator"},{"source":57,"target":56,"type":"transformator"},{"source":6,"target":57,"type":"transformator"},{"source":34,"target":57,"type":"transformator"},{"source":58,"target":59,"type":"transformator"},{"source":58,"target":65,"type":"transformator"},{"source":53,"target":58,"type":"transformator"},{"source":59,"target":64,"type":"receiver"},{"source":60,"target":59,"type":"transformator"},{"source":58,"target":59,"type":"transformator"},{"source":60,"target":59,"type":"transformator"},{"source":6,"target":60,"type":"transformator"},{"source":0,"target":60,"type":"transformator"},{"source":40,"target":60,"type":"transformator"},{"source":34,"target":60,"type":"transformator"},{"source":61,"target":60,"type":"transformator"},{"source":61,"target":60,"type":"transformator"},{"source":62,"target":61,"type":"transformator"},{"source":30,"target":61,"type":"transformator"},{"source":63,"target":61,"type":"transformator"},{"source":62,"target":61,"type":"emitter"},{"source":63,"target":61,"type":"transformator"},{"source":30,"target":63,"type":"transformator"},{"source":65,"target":67,"type":"receiver"},{"source":66,"target":65,"type":"transformator"},{"source":58,"target":65,"type":"transformator"},{"source":66,"target":65,"type":"emitter"}]


var width = window.innerWidth * 10;
var height = window.innerHeight * 10;

var force = d3.layout.force()
    .nodes(d3.values(nodes))
    .links(links)
    .size([width, height])
    .linkDistance(200)
    .charge(-5000)
    .on("tick", tick)
    .start();

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

// Per-type markers, as they don't inherit styles.
svg.append("defs").selectAll("marker")
    .data(["transformator", "receiver", "emitter"])
    .enter().append("marker")
    .attr("id", function(d) { return d; })
    .attr("viewBox", "0 -5 10 10")
    .attr("refX", 15)
    .attr("refY", -1.5)
    .attr("markerWidth", 6)
    .attr("markerHeight", 6)
    .attr("orient", "auto")
    .append("path")
    .attr("d", "M0,-5L10,0L0,5");

var path = svg.append("g").selectAll("path")
    .data(force.links())
    .enter().append("path")
    .attr("class", function(d) { return "link " + d.type; })
    .attr("marker-end", function(d) { return "url(#" + d.type + ")"; });

var circle = svg.append("g").selectAll("circle")
    .data(force.nodes())
    .enter().append("circle")
    .attr("r", 10)
    .call(force.drag);

var text = svg.append("g").selectAll("text")
    .data(force.nodes())
    .enter().append("text")
    .attr("x", 8)
    .attr("y", ".31em")
    .text(function(d) { return d.name; });

function tick() {
    path.attr("d", linkArc);
    circle.attr("transform", transform);
    text.attr("transform", transform);
}

function linkArc(d) {
  var dx = d.target.x - d.source.x,
      dy = d.target.y - d.source.y,
      dr = 0 // Math.sqrt(dx * dx + dy * dy);
  return "M" + d.source.x + "," + d.source.y + "A" + dr + "," + dr + " 0 0,1 " + d.target.x + "," + d.target.y;
}

function transform(d) {
    return "translate(" + d.x + "," + d.y + ")";
}
